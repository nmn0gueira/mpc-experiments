# EMP-toolkit
[EMP-toolkit](https://github.com/emp-toolkit) is a set of MPC frameworks based on garbled circuits written in C++ and used as libraries. This repository tests the [semi-honest implementation of Yao](https://github.com/emp-toolkit/emp-sh2pc) (`sh2pc`).

## Development
Development was done through a development container using the repositories' `devcontainer.json` file along with its Dockerfile. This will allow you to develop in a consistent environment with all the necessary dependencies.

If you want to use the development container, you will need to have Docker installed on your machine and a code editor that supports devcontainers (e.g., Visual Studio Code).

Otherwise, you will need Ubuntu 24.04 and the required dependencies on your machine:
- software-properties-common
- cmake
- build-essential
- libssl-dev
- emp-toolkit (emp-tool, emp-ot, emp-sh2pc)


## Compilation

```bash
mkdir build
cd build
cmake ..
make
```

## Usage
### Generating input data
To run the examples, you will need sample data. This data can be generated with the python script included in the repository. Usage of the script is as follows:

```bash
python3 geninput.py -e <ex> -n <bitsize> -l <numrows>
```

The default for -n and -l is 32 and 10 respectively.

### Running the examples
Some examples may have slightly different arguments where it is best to check the usage by simplifying executing the program without arguments. In general, to run an example you can run the following command for Alice:

```bash
./bin/<ex> 1 <port> <input file>
```

And the following for Bob:

```bash
./bin/<ex> 2 <port> <ip> <input file>
```

Alternatively, you can use the `run.sh` script for easier usage:
```bash
scripts/run.sh [-a] [-b <alice_address>] <program_name> [<args>]
```
The `-a` and `-b` flags are used to indicate which party is running the program. If Bob is running the program, Alice's address should be provided within the `-b` flag.
This script will automatically use the input generated by the `geninput.py` script and run the programs with fixed parameters.

#### Docker
If you want to run the examples in a Docker environment, you can either build your own Docker image using the `Dockerfile` included in the repository or use the `compose.yaml` file included in the repository providing arguments in a linux environment (through export).

## Additional Notes
- `xtabs`:
    - The `average` function reveals the sum and count of the values before calculating the averages themselves to avoid working with floats inside the circuit. This is a trade-off between precision and efficiency. An implementation that works with floats is included in the source code but is not used in the example.
- `hist2d`:
    - The `hist2d` function uses integers for the binning of the data. This may very slightly impact precision loss in binning but proves much more efficient. An implementation that works with floats is included in the source code but is not used in the example.


## TBD
This section includes work that has not been completed yet for this particular framework.

### Additions
- `ag2pc`:
	- Add testing for the maliciously secure protocol with authenticated garbling. This would require some adaptations to current programs to be able to generate the garbled circuit for a given program. 
    > Additionally, the `ag2pc` protocol seems to require all inputs of a party to be initialized before the inputs of the other party. For `xtabs` for example, this means specifying the columns of one party before the other (e.g., `a0a1 b1`, `b0b1 a0`, etc.).